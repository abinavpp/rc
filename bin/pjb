#! /bin/bash

profile="$1"
worktree="$2"
shift 2

dir=~/pj/$worktree
build="$dir/build/$profile"
target="$dir/target/$profile"

if [ -d "$build" ]; then
    cd "$build" || exit 1
    [ -f build.ninja ] && ninja "$@" && exit
    [ -f Makefile ] && make "$@" && exit
    exit 1
elif [ -d "$target" ]; then
    cd "$dir" || exit 1
    [ "$profile" = "debug" ] && profile="dev"
    cargo build --profile "$profile" "$@"
else
    exit 1
fi
